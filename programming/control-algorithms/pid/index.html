<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://agincourtskunkworks.github.io/FRCDocs/programming/control-algorithms/pid/ rel=canonical><link href=../bang-bang/ rel=prev><link href=../../generic-wrappers/ rel=next><link rel=icon href=../../../assets/logo.ico><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.21"><title>PID - FRC Team 1246 Docs</title><link rel=stylesheet href=../../../assets/stylesheets/main.66ac8b77.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=grey> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#pid-control class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="FRC Team 1246 Docs" class="md-header__button md-logo" aria-label="FRC Team 1246 Docs" data-md-component=logo> <img src=../../../assets/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> FRC Team 1246 Docs </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> PID </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/AgincourtSkunkworks/FRCDocs title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../design/ class=md-tabs__link> Design </a> </li> <li class=md-tabs__item> <a href=../../../build/ class=md-tabs__link> Build </a> </li> <li class=md-tabs__item> <a href=../../../electrical/ class=md-tabs__link> Electrical </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> Programming </a> </li> <li class=md-tabs__item> <a href=../../../business/ class=md-tabs__link> Business </a> </li> <li class=md-tabs__item> <a href=../../../WIP/ class=md-tabs__link> Other </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="FRC Team 1246 Docs" class="md-nav__button md-logo" aria-label="FRC Team 1246 Docs" data-md-component=logo> <img src=../../../assets/logo.svg alt=logo> </a> FRC Team 1246 Docs </label> <div class=md-nav__source> <a href=https://github.com/AgincourtSkunkworks/FRCDocs title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <div class="md-nav__link md-nav__container"> <a href=../../../design/ class="md-nav__link "> <span class=md-ellipsis> Design </span> </a> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Design </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../../../build/ class="md-nav__link "> <span class=md-ellipsis> Build </span> </a> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Build </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <div class="md-nav__link md-nav__container"> <a href=../../../electrical/ class="md-nav__link "> <span class=md-ellipsis> Electrical </span> </a> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Electrical </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <div class="md-nav__link md-nav__container"> <a href=../../ class="md-nav__link "> <span class=md-ellipsis> Programming </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Programming </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> Firmware </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Firmware </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../firmware/gyro-navx2/ class=md-nav__link> <span class=md-ellipsis> Gyro (NavX) </span> </a> </li> <li class=md-nav__item> <a href=../../firmware/radio/ class=md-nav__link> <span class=md-ellipsis> Radio </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> Control Algorithms </span> </a> <label class="md-nav__link " for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=true> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> Control Algorithms </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../bang-bang/ class=md-nav__link> <span class=md-ellipsis> Bang Bang </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> PID </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> PID </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of Contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of Contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#use-cases class=md-nav__link> <span class=md-ellipsis> Use Cases </span> </a> </li> <li class=md-nav__item> <a href=#theory class=md-nav__link> <span class=md-ellipsis> Theory </span> </a> <nav class=md-nav aria-label=Theory> <ul class=md-nav__list> <li class=md-nav__item> <a href=#principle class=md-nav__link> <span class=md-ellipsis> Principle </span> </a> <nav class=md-nav aria-label=Principle> <ul class=md-nav__list> <li class=md-nav__item> <a href=#p-proportional class=md-nav__link> <span class=md-ellipsis> P (Proportional) </span> </a> </li> <li class=md-nav__item> <a href=#i-integral class=md-nav__link> <span class=md-ellipsis> I (Integral) </span> </a> <nav class=md-nav aria-label="I (Integral)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#integral-windup class=md-nav__link> <span class=md-ellipsis> Integral Windup </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#d-derivative class=md-nav__link> <span class=md-ellipsis> D (Derivative) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#signals class=md-nav__link> <span class=md-ellipsis> Signals </span> </a> <nav class=md-nav aria-label=Signals> <ul class=md-nav__list> <li class=md-nav__item> <a href=#input class=md-nav__link> <span class=md-ellipsis> Input </span> </a> </li> <li class=md-nav__item> <a href=#output class=md-nav__link> <span class=md-ellipsis> Output </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tuning class=md-nav__link> <span class=md-ellipsis> Tuning </span> </a> <nav class=md-nav aria-label=Tuning> <ul class=md-nav__list> <li class=md-nav__item> <a href=#setpoints class=md-nav__link> <span class=md-ellipsis> Setpoints </span> </a> </li> <li class=md-nav__item> <a href=#initial-estimates class=md-nav__link> <span class=md-ellipsis> Initial Estimates </span> </a> <nav class=md-nav aria-label="Initial Estimates"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#p-proportional_1 class=md-nav__link> <span class=md-ellipsis> P (Proportional) </span> </a> </li> <li class=md-nav__item> <a href=#i-integral-and-d-derivative class=md-nav__link> <span class=md-ellipsis> I (Integral) and D (Derivative) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tuning-process class=md-nav__link> <span class=md-ellipsis> Tuning Process </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sample-implementation class=md-nav__link> <span class=md-ellipsis> Sample Implementation </span> </a> <nav class=md-nav aria-label="Sample Implementation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#scenario class=md-nav__link> <span class=md-ellipsis> Scenario </span> </a> </li> <li class=md-nav__item> <a href=#flowchart class=md-nav__link> <span class=md-ellipsis> Flowchart </span> </a> </li> <li class=md-nav__item> <a href=#code class=md-nav__link> <span class=md-ellipsis> Code </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#helpful-links class=md-nav__link> <span class=md-ellipsis> Helpful Links </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_4> <div class="md-nav__link md-nav__container"> <a href=../../generic-wrappers/ class="md-nav__link "> <span class=md-ellipsis> Generic Wrappers </span> </a> <label class="md-nav__link " for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> Generic Wrappers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../generic-wrappers/joystick/ class=md-nav__link> <span class=md-ellipsis> Joystick </span> </a> </li> <li class=md-nav__item> <a href=../../generic-wrappers/motor-controller/ class=md-nav__link> <span class=md-ellipsis> Motor Controller </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <div class="md-nav__link md-nav__container"> <a href=../../../business/ class="md-nav__link "> <span class=md-ellipsis> Business </span> </a> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Business </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Other </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Other </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../WIP/ class=md-nav__link> <span class=md-ellipsis> Work in Progress </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/AgincourtSkunkworks/FRCDocs/edit/master/docs/programming/control-algorithms/pid.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <a href=https://github.com/AgincourtSkunkworks/FRCDocs/raw/master/docs/programming/control-algorithms/pid.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg> </a> <h1 id=pid-control>PID Control<a class=headerlink href=#pid-control title="Jump to Section">&para;</a></h1> <p>While math is inevitable when talking about PID, this documentation is designed to use as little math as possible, and instead focus on the practical and basic theoretical aspects of PID control. You can find more detailed information on the math behind PID in the <a href=#helpful-links>Helpful Links</a> section.</p> <h2 id=use-cases>Use Cases<a class=headerlink href=#use-cases title="Jump to Section">&para;</a></h2> <p>PID control, or Proportional-Integral-Derivative control, is a sophisticated &amp; flexible control algorithm that is commonly used in scenarios where precise and efficient control of various mechanisms is needed. PID is able to account for a wide range of scenarios, including those where external factors may affect the system's behaviour. It can run until a certain condition is met, or run infinitely to maintain a certain state. Here are some scenarios where PID control may be used in FRC:</p> <ul> <li>Controlling the position of an arm or elevator mechanism</li> <li>Driving on a balancing mechanism until a certain angle is achieved</li> <li>Following a predefined path using a motion profile</li> </ul> <p>You'll notice that these scenarios are more advanced than those where <a href=../bang-bang/ >Bang-Bang control</a> would be used.</p> <h2 id=theory>Theory<a class=headerlink href=#theory title="Jump to Section">&para;</a></h2> <pre class=mermaid><code>flowchart LR
    s([Start]) --&gt; ce[Calculate Error]
    ce --&gt; p[Calculate P]
    ce --&gt; i[Calculate I]
    i --&gt; ic[Cap I]
    ce --&gt; d[Calculate D]
    p --&gt; |+| o[Calculate Output]
    ic --&gt; |+| o
    d --&gt; |+| o
    o --&gt; so[Set Output]
    so --&gt; s</code></pre> <h3 id=principle>Principle<a class=headerlink href=#principle title="Jump to Section">&para;</a></h3> <p>For all equations, <span class=arithmatex>\(e(t)\)</span> is the error at time <span class=arithmatex>\(t\)</span>, <span class=arithmatex>\(K_p\)</span> is the proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>, <span class=arithmatex>\(K_i\)</span> is the integral <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>, <span class=arithmatex>\(K_d\)</span> is the derivative <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>, and <span class=arithmatex>\(t\)</span> is the time. The result of the PID control algorithm is the sum of the three components: <span class=arithmatex>\(\text{output} = P(t) + I(t) + D(t)\)</span></p> <h4 id=p-proportional>P (Proportional)<a class=headerlink href=#p-proportional title="Jump to Section">&para;</a></h4> <div class=arithmatex>\[ P(t) = K_p\cdot e(t) \]</div> <p>The proportional term is the most straightforward of the three components. It is simply the error multiplied by a constant <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>. The proportional term is responsible for the immediate response of the system to changes in the error. A higher proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr> will result in a faster response to changes in the error, but may also result in overshooting the target value.</p> <p>The proportional term is what provides most of the output in the PID controller. The integral and derivative terms are used to fine-tune the output, and allow the system to respond to changes more effectively, but the proportional term is what provides the bulk of the output.</p> <p><strong>SIMPLIFIED</strong>: The proportional term directly scales the error to the output based on a constant. The relationship between the error and the P term output is linear. A higher constant will result in a more aggressive response to the error, but may also result in overshooting the target value.</p> <details class=note open=open> <summary>Graph</summary> <p><vegachart style="width: 100%" class=vegalite>{ "title": "Sample Proportional Output vs Error Graph", "data": { "values": [ {"error": 0, "output": 0}, {"error": 10, "output": 5}, {"error": 20, "output": 10} ] }, "mark": "line", "encoding": { "x": {"field": "error", "type": "quantitative", "title": "Error", "axis": {"labels": false}}, "y": {"field": "output", "type": "quantitative", "title": "Proportional Output", "axis": {"labels": false}} } }</vegachart></p> </details> <h4 id=i-integral>I (Integral)<a class=headerlink href=#i-integral title="Jump to Section">&para;</a></h4> <div class=arithmatex>\[ I(t) = K_i\cdot\int_0^t e(\tau) d\tau \]</div> <p>The integral term is used to account for the accumulated error over time. It is the sum of the error over time, multiplied by a constant <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>. The integral term is responsible for correcting any <abbr title="The error that remains after the system has reached a steady (constant) state.">steady-state error</abbr> that may be present in the system. A higher integral <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr> will result in a faster correction of <abbr title="The error that remains after the system has reached a steady (constant) state.">steady-state error</abbr>, but may also result in overshooting the target value.</p> <p><strong>SIMPLIFIED</strong>: The integral term accumulates the error over time, which allows the system to overcome any resistances that may be present.</p> <details class=note open=open> <summary>Graph</summary> <p><vegachart style="width: 100%" class=vegalite>{ "title": "Sample Position vs. Time Graph", "data": { "values": [ {"legend": "Setpoint", "time": 0, "position": 4}, {"legend": "Setpoint", "time": 4, "position": 4}, {"legend": "System wo/ Integral", "time": 0, "position": 0}, {"legend": "System wo/ Integral", "time": 0.5, "position": 3.5}, {"legend": "System wo/ Integral", "time": 4, "position": 3.5}, {"legend": "System w/ Integral", "time": 0, "position": 0}, {"legend": "System w/ Integral", "time": 0.46, "position": 3.5}, {"legend": "System w/ Integral", "time": 0.9, "position": 4}, {"legend": "System w/ Integral", "time": 4, "position": 4} ] }, "mark": { "type": "line", "interpolate": "monotone" }, "encoding": { "x": {"field": "time", "type": "temporal", "title": "Time", "axis": {"labels": false}}, "y": {"field": "position", "type": "quantitative", "title": "Position", "axis": {"labels": false}}, "color": {"field": "legend", "type": "nominal", "title": "Legend"} } }</vegachart></p> <p>In this sample graph, we are assuming that there is resistance present in the system that is not accounted for in the P term, and in the system with the integral term, it is well-tuned. As can be seen, the system without the integral term is unable to reach the <abbr title="The desired value that the system should reach.">setpoint</abbr>, and instead has a <abbr title="The error that remains after the system has reached a steady (constant) state.">steady-state error</abbr>. The system with the integral term, however, is able to accumulate the error over time, which allows it to overcome the resistance and reach the <abbr title="The desired value that the system should reach.">setpoint</abbr>.</p> </details> <div class="admonition example"> <p class=admonition-title>Example</p> <p>Consider a PID controller with only a P term that is being used to drive a set distance. If we encounter a slight uphill slope that was not accounted for in the P term, the output may not be high enough to overcome the resistance. Now, if we were to add an I term, it would accumulate the error over time, which slowly increases the output, allowing the system to overcome the resistance.</p> </div> <h5 id=integral-windup>Integral Windup<a class=headerlink href=#integral-windup title="Jump to Section">&para;</a></h5> <p>Integral windup is a phenomenon that causes the integral term to build up an unexpectedly large value. This can happen when the system does not respond quickly enough to correct a large error. This results in the output of the PID controller being excessively high, which can cause the system to go too fast, overshoot the target value, or similar.</p> <p>There are multiple methods that can be used to mitigate the problem of integral windup. However, <strong>the most common method we use in FRC is to cap the integral term at a specific value</strong>, which we do not want it to exceed. This will prevent the integral term from building up an excessively large value that we are not able to handle, however will limit its ability to correct for large resistances.</p> <details class=note open=open> <summary>Graph</summary> <p><vegachart style="width: 100%" class=vegalite>{ "title": "Sample Position vs. Time Graph", "data": { "values": [ {"legend": "Setpoint", "time": 0, "position": 4}, {"legend": "Setpoint", "time": 4, "position": 4}, {"legend": "Setpoint", "time": 4, "position": 2}, {"legend": "Setpoint", "time": 8, "position": 2}, {"legend": "System w/ Integral (Capped)", "time": 0, "position": 0}, {"legend": "System w/ Integral (Capped)", "time": 0.5, "position": 4}, {"legend": "System w/ Integral (Capped)", "time": 4, "position": 4}, {"legend": "System w/ Integral (Capped)", "time": 4.5, "position": 2}, {"legend": "System w/ Integral (Capped)", "time": 8, "position": 2}, {"legend": "System w/ Integral (Uncapped)", "time": 0, "position": 0}, {"legend": "System w/ Integral (Uncapped)", "time": 0.5, "position": 4.2}, {"legend": "System w/ Integral (Uncapped)", "time": 0.75, "position": 3.95}, {"legend": "System w/ Integral (Uncapped)", "time": 1, "position": 4}, {"legend": "System w/ Integral (Uncapped)", "time": 4, "position": 4}, {"legend": "System w/ Integral (Uncapped)", "time": 4.5, "position": 1.80}, {"legend": "System w/ Integral (Uncapped)", "time": 4.75, "position": 2.05}, {"legend": "System w/ Integral (Uncapped)", "time": 5, "position": 2}, {"legend": "System w/ Integral (Uncapped)", "time": 8, "position": 2} ] }, "mark": { "type": "line", "interpolate": "monotone" }, "encoding": { "x": {"field": "time", "type": "temporal", "title": "Time", "axis": {"labels": false}}, "y": {"field": "position", "type": "quantitative", "title": "Position", "axis": {"labels": false}}, "color": {"field": "legend", "type": "nominal", "title": "Legend"} } }</vegachart></p> <p>In this sample graph, we are assuming that there is little resistance present in the system that is not accounted for in the P term, and the integral <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr> is on the high side. As can be seen, the system with the uncapped integral term overshoots the <abbr title="The desired value that the system should reach.">setpoint</abbr>. This is a result of integral windup, and can be [mostly] mitigated by capping the integral term (or using other measures), as shown in the capped variant, where there is little to no overshooting.</p> </details> <h4 id=d-derivative>D (Derivative)<a class=headerlink href=#d-derivative title="Jump to Section">&para;</a></h4> <div class=arithmatex>\[ D(t) = K_d\cdot\frac{de(t)}{dt} \]</div> <p>The derivative term is used to account for the rate of change of the error. It is the derivative of the error with respect to time, multiplied by a constant <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>. The derivative term is responsible for smoothing out the response of the system to changes in the error. A higher derivative <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr> will result in a faster response to changes in the error, but may also result in oscillations around the target value.</p> <p>By smoothing out the response with the derivate term, we are also able to use a higher proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr> (P term) which would allow the system to respond faster to the error. The derivative term will then slow down the system as it approaches the target value, which prevents the system from overshooting, even with this aggressive response. This is commonly used in applications where time to reach the target value is important, but we still want to avoid overshooting (and thus, time to correct), as much as possible.</p> <p><strong>SIMPLIFIED</strong>: The derivative term calculates the rate of change of the error, which allows the system to adjust the output for a smoother response. Essentially, as the error approaches the target value, the derivative term will reduce the output to prevent overshooting.</p> <details class=note open=open> <summary>Graph</summary> <p><vegachart style="width: 100%" class=vegalite>{ "title": "Sample Position vs. Time Graph", "data": { "values": [ {"legend": "Setpoint", "time": 0, "position": 1}, {"legend": "Setpoint", "time": 6, "position": 1}, {"legend": "Underdamped", "time": 0, "position": 0}, {"legend": "Underdamped", "time": 0.4, "position": 1.6}, {"legend": "Underdamped", "time": 0.8, "position": 0.7}, {"legend": "Underdamped", "time": 1.2, "position": 1.15}, {"legend": "Underdamped", "time": 1.6, "position": 0.925}, {"legend": "Underdamped", "time": 2, "position": 1.0375}, {"legend": "Underdamped", "time": 2.4, "position": 0.98125}, {"legend": "Underdamped", "time": 2.8, "position": 1}, {"legend": "Underdamped", "time": 6, "position": 1}, {"legend": "Critically Damped", "time": 0, "position": 0}, {"legend": "Critically Damped", "time": 3, "position": 1}, {"legend": "Critically Damped", "time": 6, "position": 1}, {"legend": "Overdamped", "time": 0, "position": 0}, {"legend": "Overdamped", "time": 5.5, "position": 1}, {"legend": "Overdamped", "time": 6, "position": 1} ] }, "mark": { "type": "line", "interpolate": "monotone" }, "encoding": { "x": {"field": "time", "type": "temporal", "title": "Time", "axis": {"labels": false}}, "y": {"field": "position", "type": "quantitative", "title": "Position", "axis": {"labels": false}}, "color": {"field": "legend", "type": "nominal", "title": "Legend", "legend": { "values": ["Setpoint", "Underdamped", "Overdamped", "Critically Damped"] }} } }</vegachart></p> <p>In this sample graph, we are assuming that we have an aggressive proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>. The different lines represent different amounts of damping (from the derivative term) being applied, and how it affects the system's response.</p> <ul> <li><strong>Underdamped</strong>: Can occur when an aggressive proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr> is set, with an insufficiently large derivative <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr> (damp). Results in oscillations around the <abbr title="The desired value that the system should reach.">set point</abbr>, until settled.</li> <li><strong>Overdamped</strong>: Can occur when the derivative <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr> (damp) is too large for the proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>. Results in a longer than necessary time to reach the <abbr title="The desired value that the system should reach.">set point</abbr>.</li> <li><strong>Critically Damped</strong>: A well-tuned derivative term (damp) for the proportional term.</li> </ul> </details> <div class="admonition example"> <p class=admonition-title>Example</p> <p>Consider a PID controller with only a P term that is being used to drive a set distance. If we encounter a sudden downhill slope that was not accounted for in the P term, the output may be too high, causing the system to overshoot the target value. Now, if we were to add a D term, it would calculate the rate of change of the error, which would reduce the output as the error approaches the target value, slowing it down and preventing overshooting.</p> </div> <h3 id=signals>Signals<a class=headerlink href=#signals title="Jump to Section">&para;</a></h3> <h4 id=input>Input<a class=headerlink href=#input title="Jump to Section">&para;</a></h4> <p>The input to a PID controller should be the error of the system. The error is the difference between the desired value and the actual value of the system. The error can be calculated using sensors, encoders, or other feedback mechanisms that provide information about the system's state. A common use case of PID, to reach a desired motor position, uses the difference between the desired position of the motor in encoder ticks (<abbr title="The desired value that the system should reach.">set point</abbr>) and the current position of the motor in encoder ticks (feedback).</p> <h4 id=output>Output<a class=headerlink href=#output title="Jump to Section">&para;</a></h4> <p>The output of a PID controller is a variable value that is used to control the system. The device being controlled should be able to accept this variable value and adjust its state accordingly to achieve the intended effect. For example, motors, which are one of the most common use cases of PID, can accept the output of the PID controller as a percent speed value.</p> <h2 id=tuning>Tuning<a class=headerlink href=#tuning title="Jump to Section">&para;</a></h2> <p>The output of PID control needs to be adjusted to achieve the expected system response. This is done by tuning the three constants involved in PID, <span class=arithmatex>\(K_p\)</span>, <span class=arithmatex>\(K_i\)</span>, and <span class=arithmatex>\(K_d\)</span>. It is unlikely that estimated values for these constants will work well, and as such, a tuning process with the actual system is required to find the optimal values. This section of the documentation will cover the process of tuning a PID controller.</p> <h3 id=setpoints>Setpoints<a class=headerlink href=#setpoints title="Jump to Section">&para;</a></h3> <p>The process of obtaining <abbr title="The desired value that the system should reach.">setpoints</abbr> will differ depending on the input used for the PID controller. Generally, if it cannot be theoretically determined, it will consist of logging the input value continuously, physically manipulating the robot to the desired position, and recording the value. This should be done numerous times, with an average measurement taken to ensure an accurate reading.</p> <p>In FRC, using PID to reach (and/or hold) a particular motor position is common. While the <abbr title="The desired value that the system should reach.">setpoint</abbr> for this <em>could</em> be theoretically determined with knowledge of the distance corresponding to each encoder tick (taking into account gearboxes and other physical attributes), this is often inaccurate as a result of real world conditions. Instead, it is highly suggested to experimentally determine the <abbr title="The desired value that the system should reach.">setpoint</abbr> by following the above process: logging the encoder value, manually moving to that position, and recording the encoder value to use as the <abbr title="The desired value that the system should reach.">setpoint</abbr>.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>If you see during tuning that the system is constantly moving to the wrong position, it may be worth checking that the <abbr title="The desired value that the system should reach.">setpoint</abbr> is accurate. If it is accurate, ensure that the encoder is properly zeroed in the expected position, and that shifts are not occurring in the gearbox or other mechanisms that could affect the encoder reading.</p> </div> <h3 id=initial-estimates>Initial Estimates<a class=headerlink href=#initial-estimates title="Jump to Section">&para;</a></h3> <h4 id=p-proportional_1>P (Proportional)<a class=headerlink href=#p-proportional_1 title="Jump to Section">&para;</a></h4> <p>A good starting point for the proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr> is to take the maximum expected error, and ensure that will correspond to the maximum expected output of the system. This can be later adjusted to be higher or lower, depending on how the system responds.</p> <p>Or, mathematically, where <span class=arithmatex>\(K_{p}\)</span> is the initial proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>, <span class=arithmatex>\(e_{max}\)</span> is the maximum expected error, and <span class=arithmatex>\(o_{max}\)</span> is the maximum expected output of the system:</p> <div class=arithmatex>\[ K_{p} = \frac{o_{max}}{e_{max}} \]</div> <div class="admonition example"> <p class=admonition-title>Example</p> <p>If we are using a PID controller to control the position of a motor, taking difference in position as the input, and motor percent speed as the output, the maximum expected error would usually be the distance between the <abbr title="The desired value that the system should reach.">setpoint</abbr>, and the furthest possible position. The expected output would usually be <code>1.0</code> (100%).</p> <p>If the maximum expected difference were 100 encoder ticks, then to calculate the initial <span class=arithmatex>\(K_p\)</span> value, we would use the following calculation: <span class=arithmatex>\(K_{p} = \frac{1.0}{100} = 0.01\)</span>, resulting in an initial value of <code>0.01</code>.</p> </div> <p>If the application of the PID controller does not allow for a good estimate of the initial proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>, it is suggested to start with a low value, and increase it gradually until the system responds as expected. This prevents potentially hazardous situations that could arise from an extremely aggressive response.</p> <h4 id=i-integral-and-d-derivative>I (Integral) and D (Derivative)<a class=headerlink href=#i-integral-and-d-derivative title="Jump to Section">&para;</a></h4> <p>Usually, the integral and derivative gains are set to zero initially, and are only adjusted as needed during the tuning process. This is because the integral and derivative terms are used to fine-tune the output of the system, or account for specific scenarios, and may not necessarily be needed in all cases. It should be obvious during the tuning process if the integral or derivative terms are needed, at which point they can be adjusted accordingly.</p> <h3 id=tuning-process>Tuning Process<a class=headerlink href=#tuning-process title="Jump to Section">&para;</a></h3> <p>Put simply, the process of tuning PID consists of testing the system, adjusting the constants based on the system's behaviour, and repeating until the system responds as expected. Knowing what constants to adjust, and by how much is a skill that comes with experience, and is not something that can be easily taught. However, the following guidelines can be used to help you get started:</p> <ol> <li><strong>Start with the Proportional Gain</strong>: The proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr> is the most important of the three constants, and should be adjusted first. Start with the <a href=#initial-estimates>initial estimate</a>, and adjust it until the system responds as expected.<ul> <li>If the system moves slowly, or stalls often before reaching the <abbr title="The desired value that the system should reach.">setpoint</abbr>, try increasing the proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>.</li> <li>If the system overshoots the <abbr title="The desired value that the system should reach.">setpoint</abbr> by a large amount, or oscillates around the <abbr title="The desired value that the system should reach.">setpoint</abbr>, try decreasing the proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>.</li> <li>If you find yourself unable to find a good balance between the two, try utilizing the integral and/or derivative terms, before adjusting the proportional <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr> further.</li> </ul> </li> <li><strong>Evaluate the Integral Term</strong>: If the system is expected to encounter resistance that the proportional term cannot overcome, or if it is observed that there is a <abbr title="The error that remains after the system has reached a steady (constant) state.">steady-state error</abbr> that cannot be handled with the proportional term, the integral term should be implemented. Start with a low value, and increase it until the system responds as expected.<ul> <li>If the system does not appear to be compensating enough for resistance, try increasing the integral <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>.</li> <li>If the system overshoots the <abbr title="The desired value that the system should reach.">setpoint</abbr>, or oscillates around the <abbr title="The desired value that the system should reach.">setpoint</abbr>, try decreasing the integral <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>.</li> <li>If you find yourself in a position where the integral <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr> cannot be lowered further without being ineffective, but overshooting is still occurring in better conditions, try <a href=#integral-windup>capping the integral term</a>, or utilizing the derivative term to smooth out the response.</li> </ul> </li> <li><strong>Evaluate the Derivative Term</strong>: If the system is tuned aggressively, and it is observed that the system often overshoots the <abbr title="The desired value that the system should reach.">setpoint</abbr>, or the speed of the system nearing the <abbr title="The desired value that the system should reach.">setpoint</abbr> is too high, the derivative term should be implemented. Start with a low value, and increase it until the system responds as expected.<ul> <li>If the system is still moving too fast, overshoots the <abbr title="The desired value that the system should reach.">setpoint</abbr>, or oscillates around the <abbr title="The desired value that the system should reach.">setpoint</abbr>, try increasing the derivative <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>.</li> <li>If the system moves slowly, or stalls often before reaching the <abbr title="The desired value that the system should reach.">setpoint</abbr>, try decreasing the derivative <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>.</li> </ul> </li> <li><strong>Repeat</strong>: After adjusting the constants, test the system again, and repeat the process by adjusting &amp; fine-tuning the constants until the system works well consistently under all conditions.</li> </ol> <h2 id=sample-implementation>Sample Implementation<a class=headerlink href=#sample-implementation title="Jump to Section">&para;</a></h2> <h3 id=scenario>Scenario<a class=headerlink href=#scenario title="Jump to Section">&para;</a></h3> <p>We have an arm mechanism with a motor attached at a pivot point. We want the arm to be able to move to a specific angle (motor position), and hold that position against gravity or other resistances.</p> <h3 id=flowchart>Flowchart<a class=headerlink href=#flowchart title="Jump to Section">&para;</a></h3> <p>As PID control mostly varies not in implementation, but in the constants used, the flowchart provided in the <a href=#theory>Theory</a> section would still be representative of this sample scenario.</p> <h3 id=code>Code<a class=headerlink href=#code title="Jump to Section">&para;</a></h3> <p>We will not be using the premade PID classes provided by WPILib, nor our own generic PID classes. Instead, we will be showing the relevant segments of a simple from-scratch PID controller that would be suitable for this use case. This should give you a better understanding of how PID works, and how it can be implemented or modified to suit your needs.</p> <p>We will be referencing a few other classes that are not shown here, such as the <code>Timer</code> class, provided by WPILib, to get the time, the <code>Controller</code> class, which represents a standard motor controller, and <code>PIDConstants</code>, which represents some class containing the necessary constants for the PID controller. The following class diagram shows the classes we will be using:</p> <pre class=mermaid><code>classDiagram
    class Timer {
        +getFPGATimestamp() double
    }

    class MotorController {
        +getPosition() double
        +setSpeed(double percentOutput)
    }

    class PIDConstants {
        +double kP
        +double kI
        +double kIMax
        +double kD
    }</code></pre> <p>Please note that the following code segment <strong>is not complete</strong>, is more verbose than necessary, and only shows the parts relevant for PID logic. An actual implementation would necessitate additional code for Command-Based interaction, logging, <abbr title="Quality of Life">QoL</abbr> features (such as on-the-fly adjustment), and more.</p> <div class=highlight><pre><span></span><code><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Timer</span><span class=w> </span><span class=n>timer</span><span class=p>;</span>
<span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MotorController</span><span class=w> </span><span class=n>motor</span><span class=p>;</span>
<span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PIDConstants</span><span class=w> </span><span class=n>constants</span><span class=p>;</span>

<span class=kd>private</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>errorSum</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=c1>// (1)!</span>
<span class=kd>private</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>lastRunTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=c1>// (2)!</span>
<span class=kd>private</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>lastError</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=c1>// (3)!</span>

<span class=c1>// ...</span>

<span class=nd>@Override</span>
<span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>execute</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>lastRunTime</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=n>lastRunTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Timer</span><span class=p>.</span><span class=na>getFPGATimestamp</span><span class=p>();</span><span class=w> </span><span class=c1>// (4)!</span>

<span class=w>    </span><span class=c1>// Calculate time since the last execution</span>
<span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>currentTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Timer</span><span class=p>.</span><span class=na>getFPGATimestamp</span><span class=p>();</span>
<span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>dt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>currentTime</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>lastRunTime</span><span class=p>;</span>

<span class=w>    </span><span class=c1>// Calculate the error and error rate</span>
<span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>error</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>setpoint</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>motor</span><span class=p>.</span><span class=na>getPosition</span><span class=p>();</span><span class=w> </span><span class=c1>// (5)!</span>
<span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>errorRate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>error</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>lastError</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>dt</span><span class=p>;</span><span class=w> </span><span class=c1>// (6)!</span>

<span class=w>    </span><span class=c1>// Accumulate the error</span>
<span class=w>    </span><span class=n>errorSum</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>error</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>dt</span><span class=p>;</span><span class=w> </span><span class=c1>// (7)!</span>
<span class=w>    </span><span class=n>errorSum</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Math</span><span class=p>.</span><span class=na>max</span><span class=p>(</span><span class=o>-</span><span class=n>constants</span><span class=p>.</span><span class=na>kIMax</span><span class=p>,</span><span class=w> </span><span class=n>Math</span><span class=p>.</span><span class=na>min</span><span class=p>(</span><span class=n>constants</span><span class=p>.</span><span class=na>kIMax</span><span class=p>,</span><span class=w> </span><span class=n>errorSum</span><span class=p>));</span><span class=w> </span><span class=c1>// (8)!</span>

<span class=w>    </span><span class=c1>// Record values for next execution</span>
<span class=w>    </span><span class=n>lastRunTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>currentTime</span><span class=p>;</span>
<span class=w>    </span><span class=n>lastError</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>error</span><span class=p>;</span>

<span class=w>    </span><span class=c1>// Calculate the PID output</span>
<span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>constants</span><span class=p>.</span><span class=na>kP</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>error</span><span class=p>;</span>
<span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>constants</span><span class=p>.</span><span class=na>kI</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>errorSum</span><span class=p>;</span>
<span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>constants</span><span class=p>.</span><span class=na>kD</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>errorRate</span><span class=p>;</span>
<span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>output</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>d</span><span class=p>;</span>

<span class=w>    </span><span class=c1>// Set the motor speed</span>
<span class=w>    </span><span class=n>motor</span><span class=p>.</span><span class=na>setSpeed</span><span class=p>(</span><span class=n>output</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <ol> <li>Used to accumulate the error over time, for the integral term.</li> <li>Used to calculate the time since the last execution, for the derivative term.</li> <li>Used to calculate the rate of change of the error, for the derivative term.</li> <li>Prevents a large delta time value on the first execution, which would result in a large derivative term output.</li> <li>The error (difference between the <abbr title="The desired value that the system should reach.">setpoint</abbr> and the current position) is used to calculate the proportional term. Remember that the proportional term is the error multiplied by a constant <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>.</li> <li>The rate of change of the error is used to calculate the derivative term. Remember that the derivative term is the rate of change of the error, multiplied by a constant <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>.</li> <li>Accumulates (sums) the error throughout the execution. We multiply the current error by the time, and add it to a running total, which is used to calculate the integral term. Remember that the integral term is the sum of the error over time, multiplied by a constant <abbr title="A constant multiplier used to scale the output of a control algorithm.">gain</abbr>.</li> <li>We cap the integral term in a bound of <code>-kIMax</code> to <code>kIMax</code>. This is to prevent integral windup, where the integral term builds up an unexpectedly large value. You can read more about this in <a href=#integral-windup>Integral Windup</a>.</li> </ol> <h2 id=helpful-links>Helpful Links<a class=headerlink href=#helpful-links title="Jump to Section">&para;</a></h2> <ul> <li>Wikipedia<ul> <li><a href=https://en.wikipedia.org/wiki/PID_controller>PID Controller</a></li> <li><a href=https://en.wikipedia.org/wiki/Proportional_control>Proportional Control</a></li> <li><a href=https://en.wikipedia.org/wiki/Integral>Integral (Math)</a></li> <li><a href=https://en.wikipedia.org/wiki/Derivative>Derivative (Math)</a></li> </ul> </li> <li><a href=https://docs.wpilib.org/en/stable/docs/software/advanced-controls/introduction/introduction-to-pid.html>FRC Documentation</a></li> <li>Video Guide (by FRC Team 6814):<ul> <li><a href="https://www.youtube.com/watch?v=jIKBWO7ps0w">Part 1</a></li> <li><a href="https://www.youtube.com/watch?v=Z24fSBVJeGs">Part 2</a></li> </ul> </li> <li><a href=https://docs.wpilib.org/en/stable/docs/software/commandbased/pid-subsystems-commands.html>WPILib PID Implementation</a></li> <li><a href=https://github.com/AgincourtSkunkworks/FRC2024/blob/31543ad1b67ef74d72f260e6cbaaed4dfaab8256/src/main/java/frc/robot/commands/GenericPID.java>Sample Custom Generic PID Command</a></li> </ul> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">April 24, 2024</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">April 16, 2024</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Contributors> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg> </span> <span>GitHub</span> <nav> <a href=https://github.com/TheodoreHua class=md-author title=@TheodoreHua> <img src="https://avatars.githubusercontent.com/u/68816042?size=72" alt=TheodoreHua> </a> </nav> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../bang-bang/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Bang Bang"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Bang Bang </div> </div> </a> <a href=../../generic-wrappers/ class="md-footer__link md-footer__link--next" aria-label="Next: Generic Wrappers"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Generic Wrappers </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/AgincourtSkunkworks target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "content.tooltips", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.path", "navigation.tabs", "navigation.top", "search.share", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.a7c05c9e.min.js></script> <script src=../../../js/mkdocs-charts-plugin.js></script> <script src=../../../assets/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://cdn.jsdelivr.net/npm/vega@5></script> <script src=https://cdn.jsdelivr.net/npm/vega-lite@5></script> <script src=https://cdn.jsdelivr.net/npm/vega-embed@6></script> <script src=../../../js/open_in_new_tab.js></script> 
        <script>
        var mkdocs_chart_plugin = {'data_path': '', 'use_data_path': 'True', 'vega_theme': 'default', 'vega_theme_dark': 'dark', 'vega_renderer': 'svg', 'vega_width': 'container', 'fallback_width': '800', 'path_to_homepage': '../../..'}
        </script>
        </body> </html>